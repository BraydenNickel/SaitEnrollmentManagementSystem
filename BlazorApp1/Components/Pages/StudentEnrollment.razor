@page "/StudentEnrollment"
@using BlazorApp1.Models

@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject StudentService StudentService
@inject ProgramService ProgramService

<PageTitle>Student Enrollment</PageTitle>
<h1>Student Enrollment</h1>
<p>Enroll a new student by filling out the form below:</p>

<EditForm Model="@student" OnSubmit="@EnrollStudent" FormName="Student Enrollment Form">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label>First Name:</label>
        <InputText @bind-Value="student.FirstName" class="form-control" />
    </div>

    <div class="form-group">
        <label>Last Name:</label>
        <InputText @bind-Value="student.LastName" class="form-control" />
    </div>

    <div class="form-group">
        <label>Date of Birth:</label>
        <InputDate @bind-Value="student.DateOfBirth" class="form-control" />
    </div>

    <div class="form-group">
        <label>Gender:</label>
        <InputText @bind-Value="student.Gender" class="form-control" />
    </div>

    <div class="form-group">
        <label>GPA:</label>
        <InputNumber @bind-Value="student.GPA" class="form-control" />
    </div>

    <div class="form-group">
        <label>Current Semester:</label>
        <InputNumber @bind-Value="student.CurrentSemester" class="form-control" />
    </div>

    <div class="form-group">
        <label>Number of Courses:</label>
        <InputNumber @bind-Value="student.NumberOfCourses" class="form-control" />
    </div>

    <div class="form-group">
        <label>Program:</label>
        <InputSelect @bind-Value="student.ProgramEnrolled" class="form-control">
        <option disabled value="">-- Select Program --
        </option>
        @foreach (var program in availablePrograms)
        {
            <option value="@program.Name">@program.Name</option>
        }
        </InputSelect>
    </div>

    <div class="form-group mb-3">
    <button class="btn btn-success" type="submit">Enroll</button>
    </div> 
</EditForm>


@code {
    private Student student = new Student();
    private List<SchoolPrograms> availablePrograms = new List<SchoolPrograms>();
    protected override void OnInitialized()
    {
        student.DateOfBirth = DateTime.Today;
        availablePrograms = ProgramService.GetAllPrograms();
    }

    private void EnrollStudent()
    {
        StudentService.EnrollStudent(
            student.FirstName,
            student.LastName,
            student.DateOfBirth,
            student.Gender,
            student.GPA,
            student.CurrentSemester,
            student.NumberOfCourses,
            student.ProgramEnrolled
        );
        try {
            NavigationManager.NavigateTo("/StudentList");
        }
        catch (Exception ex)
        {
            Console.WriteLine(value: $"Error navigating to Student List: {ex.Message}");
        }
    }
}